#!/usr/bin/env sh

# DEFAULTS
alias cp='cp -ir'
alias df="df -h"
alias du="du -h"
alias grep="grep --color"
alias ls="ls --color --group-directories-first -Ah -I __pycache__"
alias lsblk="lsblk -o name,label,mountpoint,fstype,size"
alias mkdir="mkdir -p"
alias mount="sudo mount"
alias mv="mv -i"
alias pacman="sudo pacman"
alias rm="rm -fr"
alias tmux="tmux -f \$TMUXRC"
alias top="top -1 -u \$USER"
alias umount="sudo umount"

# CPM
alias x="cpm"
alias xc="cpm -c"
alias xd="cpm -d"
alias xm="cpm -m"
alias xp="cpm -p"

# CONDA
alias cel="conda env list"
alias cer="conda env remove -n"
alias coa="conda deactivate; conda activate"
alias cod="conda deactivate"
alias coi="conda install"
alias cou="conda update --all --prune"

# DOTFILES
alias al="\$EDITOR ~/.config/aliases && . ~/.config/aliases"
alias ba="\$EDITOR ~/.bashrc && . ~/.bashrc"
alias fx="\$EDITOR ~/.config/sx/sxrc"
alias iv="\$EDITOR ~/.config/nvim/init.vim"

# DROPBOX
alias db="cd ~/Dropbox"
alias fu="cd ~/Dropbox/uni"
alias mo="cd ~/Dropbox/uni/myo"
alias n="\$EDITOR -c 'se acd' ~/Dropbox/notes/notes"
alias nn="cd ~/Dropbox/notes"
alias vm="cd ~/Dropbox/uni/vml"

# FUNCTIONS
cd() { if [ $# -eq 0 ]; then builtin cd && ls; else builtin cd "$@" && ls; fi }
d() { if [ $# -eq 0 ]; then clear; else rm "$@" && ls; fi }
di() { $BROWSER https://www.dict.cc/?s="$1"; }
ff() { builtin cd "$(find . -type d ! -path '*/\.git/*' ! -path '*/tex/*' ! -iname '.' | sed 's/^.\///' | fzf)" || echo Can not open directory.; }
flash() { sudo dd bs=4M if="$1" of="$2" status=progress oflag=sync; }
mc() { mkdir "$1" && cd "$1" || return; }
y() { youtube-dl "$@" "$(xsel -b | head -n1)"; }

# GIT
k() { n=16; [ $# != 0 ] && n=$1; git log --all --graph --decorate --oneline -n"$n"; }
kgg() { git log --color --oneline --grep "$1" | fzf --ansi --no-sort | cut -d\  -f1 | xsel -b; }
krb() { n=8; [ $# != 0 ] && n=$1; git rebase -i HEAD~"$n"; }
krh() { n=1; [ $# != 0 ] && n=$1; git reset --hard HEAD~"$n"; }

alias ka="git add"
alias kaa="git add --all"
alias kam="git commit --amend"
alias kb="git branch"
alias kbd="git branch -D"
alias kbr="git remote -v | grep -P \(push\) | cut -d ' ' -f 1 | cut -f 2 | xargs -r \$BROWSER"
alias kcl="git clone"
alias kfp="git format-patch --stdout HEAD^ >"
alias ki="git init"
alias kii="git add --all && git commit -m 'Create repository'"
alias kr="cd \$(git rev-parse --show-toplevel)"

alias kc="git commit"
alias kca="git add --all && git commit"
alias kcp="git add --all && git commit && git push"
alias kcr="git commit -am tmp && git rebase -i HEAD~2"

alias kd="git diff"
alias kk="git log --all --graph --decorate --oneline"
alias kl="git log --date=auto:human"
alias klg="git log --grep"
alias ks="git status -bs"
alias kso="git show"

alias kma="git checkout master"
alias ko="git checkout"
alias kob="git checkout -b"

alias kf="git fetch"
alias km="git merge"
alias kp="git push"
alias kpf="git push -f"
alias kpl="git pull"

alias krm="git rebase master"
alias krr="git reset --hard; git clean -f"
alias krs="git reset --soft"
alias krv="git revert"

alias ksd="git stash drop"
alias ksl="git stash list"
alias ksp="git stash pop"
alias kst="git stash"

# HOME
alias -- ,="cd .."
alias ca="cd ~/.cache"
alias co="cd ~/.config"
alias dl="cd ~/Downloads"
alias h="cd && clear"
alias lo="cd ~/.local/share"
alias tm="\$EDITOR /tmp/scratch"
alias z="cd - >/dev/null && ls"

# MEDIA
alias am="cd ~/media/asmr"
alias ms="cd ~/media/music"
alias vi="cd ~/media/videos"

# MISC
alias a="act"
alias c="cat"
alias cl="sudo pacman -Rns \$(pacman -Qttdq); sudo pacman -Sc; rm ~/.cache/*"
alias e="exit"
alias fn="\$EDITOR"
alias i="pkg -i"
alias j="fg"
alias l="ls"
alias lb="lsblk"
alias ll="ls -l"
alias m="mv"
alias ma="make; make clean"
alias md="mkdir -p"
alias o="opn"
alias oi="opn -i"
alias or="opn -r"
alias ot="opn -t"
alias p="cp"
alias pa="patch -p1 <"
alias pw="pwd | sed 's/\/home\/aleks/~/'"
alias r="pkg -r"
alias re="sudo \$(fc -ln -1)"
alias s="bst"
alias to="touch"
alias u="sudo sh -c \"curl -s 'https://www.archlinux.org/mirrorlist/?country=DE&protocol=https&use_mirror_status=on' | sed -e s/^#Server/Server/ -e /^#/d > /etc/pacman.d/mirrorlist\" && yay"
alias up="sudo sh -c \"curl -s 'https://www.archlinux.org/mirrorlist/?country=DE&protocol=https&use_mirror_status=on' | sed -e s/^#Server/Server/ -e /^#/d > /etc/pacman.d/mirrorlist\" && pacman -Syu"
alias vl="alsamixer"

# PROJECTS
alias aa="cd ~/projects/arch"
alias ad="cd ~/projects/arch && \$EDITOR desktop.sh"
alias af="cd ~/projects/arch && f"
alias dm="cd ~/projects/dmenu"
alias dw="cd ~/projects/dwm"
alias fd="cd ~/projects/dotfiles"
alias fdf="cd ~/projects/dotfiles && f"
alias fj="cd ~/projects"
alias ft="cd ~/projects/st"
alias sc="cd ~/projects/scripts"
alias scf="cd ~/projects/scripts && f"
alias si="cd ~/projects/sites"
alias sl="cd ~/projects/slock"

# TMUX
alias ta="tmux a -t"
alias tk="tmux kill-session -t"
alias tl="tmux ls"
t() { s=0; if [ $# -gt 0 ]; then s="$1"; fi; tmux new -As "$s"; }

f() {
    if [ $# -eq 0 ]; then
        fzf | xargs -r "$EDITOR"
    elif [ -d "$1" ]; then
        cd "$@" || return
    elif [ ! -f "$1" ] && [ ! -d "$1" ]; then
        echo "Can't find: $*"
    else
        mimetype=$(file -bL --mime-type "$1")
        mime=$(echo "$mimetype" | cut -d/ -f1)
        case $mime in
            "text") $EDITOR "$@" && return ;;
            "image") $BROWSER "$@" && return ;;
            "video") $PLAYER "$@" && return ;;
            "audio") $PLAYER "$@" && return ;;
        esac
        case $mimetype in
            "application/json") $EDITOR "$@" ;;
            "inode/x-empty") $EDITOR "$@" ;;
            "application/pdf") $BROWSER "$@" ;;
            "application/gzip") tar -xzf "$@" ;;
            *) echo No association with mimetype: "$mimetype" >&2 ;;
        esac
    fi
}
